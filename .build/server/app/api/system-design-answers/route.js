"use strict";(()=>{var e={};e.id=4695,e.ids=[4695],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},3971:(e,s,t)=>{t.r(s),t.d(s,{originalPathname:()=>h,patchFetch:()=>w,requestAsyncStorage:()=>y,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>f});var r={};t.r(r),t.d(r,{GET:()=>l,POST:()=>p,dynamic:()=>d});var n=t(9303),i=t(8716),o=t(670),a=t(7070),u=t(2663),c=t(5786);let d="force-dynamic";async function l(e){try{let s=await (0,c.RA)(e);if(!s)return a.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:t}=new URL(e.url),r=t.get("questionId"),n={userId:s.id};r&&(n.questionId=r);let i=await u._.systemDesignAnswer.findMany({where:n,include:{question:{include:{company:!0,systemDesignDetails:!0}}},orderBy:{updatedAt:"desc"}});return a.NextResponse.json(i)}catch(e){return console.error("Error fetching system design answers:",e),a.NextResponse.json({error:"Failed to fetch system design answers"},{status:500})}}async function p(e){try{let s=await (0,c.RA)(e);if(!s)return a.NextResponse.json({error:"Unauthorized"},{status:401});let{questionId:t,highLevelDesign:r,detailedComponents:n,scalabilityApproach:i,dataStorageStrategy:o,tradeoffsDiscussed:d,frameworksUsed:l,estimatedScale:p,notes:m}=await e.json(),y=await u._.systemDesignAnswer.upsert({where:{userId_questionId:{userId:s.id,questionId:t}},update:{highLevelDesign:r,detailedComponents:n,scalabilityApproach:i,dataStorageStrategy:o,tradeoffsDiscussed:d||[],frameworksUsed:l||[],estimatedScale:p,notes:m},create:{userId:s.id,questionId:t,highLevelDesign:r,detailedComponents:n,scalabilityApproach:i,dataStorageStrategy:o,tradeoffsDiscussed:d||[],frameworksUsed:l||[],estimatedScale:p,notes:m},include:{question:{include:{company:!0,systemDesignDetails:!0}}}});return a.NextResponse.json(y)}catch(e){return console.error("Error saving system design answer:",e),a.NextResponse.json({error:"Failed to save system design answer"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/system-design-answers/route",pathname:"/api/system-design-answers",filename:"route",bundlePath:"app/api/system-design-answers/route"},resolvedPagePath:"/home/ubuntu/em-interview-prep/app/api/system-design-answers/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:y,staticGenerationAsyncStorage:f,serverHooks:g}=m,h="/api/system-design-answers/route";function w(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:f})}},5786:(e,s,t)=>{t.d(s,{Gg:()=>d,Gv:()=>u,RA:()=>m,c_:()=>a,ed:()=>c,mk:()=>p,sd:()=>l});var r=t(2023),n=t.n(r),i=t(1615),o=t(2663);async function a(e){return n().hash(e,12)}async function u(e,s){return n().compare(e,s)}async function c(e){let s=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);return(0,i.cookies)().set("session",`${e}:${s}`,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800}),s}async function d(){try{let e=(0,i.cookies)().get("session");if(!e?.value)return null;let[s]=e.value.split(":");if(!s)return null;return await o._.user.findUnique({where:{id:s},select:{id:!0,username:!0,isAdmin:!0,preferences:!0}})}catch(e){return console.error("Session error:",e),null}}async function l(){(0,i.cookies)().delete("session")}async function p(){let e=await d();if(!e)throw Error("Authentication required");return e}async function m(e){try{let s=e.headers.get("cookie");if(!s)return null;let t=s.split(";").reduce((e,s)=>{let[t,r]=s.trim().split("=");return e[t]=r,e},{}).session;if(!t)return null;let[r]=t.split(":");if(!r)return null;return await o._.user.findUnique({where:{id:r},select:{id:!0,username:!0,isAdmin:!0,preferences:!0}})}catch(e){return console.error("Auth verification error:",e),null}}},2663:(e,s,t)=>{t.d(s,{_:()=>n});let r=require("@prisma/client"),n=globalThis.prisma??new r.PrismaClient}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[9276,4028,5972],()=>t(3971));module.exports=r})();