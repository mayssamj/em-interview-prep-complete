"use strict";(()=>{var e={};e.id=3311,e.ids=[3311],e.modules={3524:e=>{e.exports=require("@prisma/client")},2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},6348:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>x,requestAsyncStorage:()=>y,routeModule:()=>p,serverHooks:()=>v,staticGenerationAsyncStorage:()=>m});var i={};r.r(i),r.d(i,{GET:()=>l,dynamic:()=>d});var n=r(9303),a=r(8716),s=r(670),o=r(7070),u=r(5786),c=r(9487);let d="force-dynamic";async function l(e){try{let t=await (0,u.mk)(e),r=await c._.stories.findMany({where:{user_id:t.id},orderBy:{created_at:"desc"},take:3,select:{id:!0,title:!0,tags:!0,created_at:!0}}),i=await c._.answers.findMany({where:{user_id:t.id},orderBy:{created_at:"desc"},take:3,include:{questions:{select:{question_text:!0,category:!0}}}}),n=await c._.interview_notes.findMany({where:{user_id:t.id},orderBy:{created_at:"desc"},take:2,select:{id:!0,company:!0,interviewer_name:!0,created_at:!0}}),a=[...r.map(e=>({id:e.id,type:"story",title:e.title,description:"STAR format story",createdAt:e.created_at.toISOString(),tags:e.tags})),...i.map(e=>({id:e.id,type:"answer",title:e.questions.question_text.length>60?e.questions.question_text.substring(0,60)+"...":e.questions.question_text,description:`Answered ${e.questions.category} question`,createdAt:e.created_at.toISOString(),tags:[e.questions.category]})),...n.map(e=>({id:e.id,type:"note",title:`${e.company} Interview`,description:e.interviewer_name?`Interview with ${e.interviewer_name}`:"Interview experience logged",createdAt:e.created_at.toISOString(),tags:[e.company]}))];return a.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()),o.NextResponse.json(a.slice(0,5))}catch(e){return console.error("Activity fetch error:",e),o.NextResponse.json({error:"Failed to fetch activity"},{status:500})}}let p=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/dashboard/activity/route",pathname:"/api/dashboard/activity",filename:"route",bundlePath:"app/api/dashboard/activity/route"},resolvedPagePath:"/home/ubuntu/em-interview-prep/app/api/dashboard/activity/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:y,staticGenerationAsyncStorage:m,serverHooks:v}=p,g="/api/dashboard/activity/route";function x(){return(0,s.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:m})}},5786:(e,t,r)=>{r.d(t,{Gg:()=>u,Z1:()=>c,mk:()=>o});var i=r(1482),n=r.n(i);r(9487);let a=process.env.JWT_SECRET||"your-secret-key";async function s(e){try{let t=e.cookies.get("token")?.value;if(!t)return null;let r=n().verify(t,a);if(!r.userId)return null;return{id:r.userId,username:r.username,isAdmin:r.isAdmin||!1}}catch(e){return console.error("Token verification error:",e),null}}async function o(e){let t=await s(e);if(!t)throw Error("Authentication required");return t}async function u(e){return e?await s(e):null}async function c(){try{let{cookies:e}=await r.e(1615).then(r.bind(r,1615)),t=e(),i=t.get("token")?.value;if(!i)return null;let s=n().verify(i,a);if(!s.userId)return null;return{id:s.userId,username:s.username,isAdmin:s.isAdmin||!1}}catch(e){return console.error("Server session error:",e),null}}},9487:(e,t,r)=>{r.d(t,{_:()=>n});var i=r(3524);let n=globalThis.prisma??new i.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[9276,5972,2023,1482],()=>r(6348));module.exports=i})();